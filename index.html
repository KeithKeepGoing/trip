<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <title>2026 æ±äº¬å®¶åº­æ—…è¡Œ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        color-scheme: light;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: #0f172a;
        color: #0f172a;
      }
      .page {
        min-height: 100vh;
        background: linear-gradient(to bottom, #b91c1c 0, #b91c1c 220px, #0f172a 220px, #0f172a 100%);
      }
      .app {
        max-width: 1100px;
        margin: 0 auto;
        padding: 12px 12px 32px;
      }
      /* Header */
      .hero-card {
        background: transparent;
        color: #fee2e2;
        text-align: center;
        padding: 4px 0 12px;
      }
      .hero-title {
        font-size: 1.8rem;
        font-weight: 800;
        letter-spacing: 0.08em;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
      }
      .hero-subtitle {
        margin-top: 4px;
        font-size: 0.9rem;
        opacity: 0.9;
      }
      .hero-date {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        margin-top: 8px;
        padding: 4px 10px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.25);
        font-size: 0.82rem;
      }
      .hero-date-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 18px;
        height: 18px;
        border-radius: 999px;
        background: #0f172a;
        color: #f97316;
        font-size: 0.8rem;
      }
      /* Tabs strip */
      .tabs-strip {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        justify-content: center;
        padding: 8px 6px 0;
      }
      .tab-pill {
        min-width: 54px;
        padding: 5px 10px;
        border-radius: 999px;
        border: 1px solid rgba(15, 23, 42, 0.4);
        background: rgba(15, 23, 42, 0.85);
        color: #e5e7eb;
        font-size: 0.8rem;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
      }
      .tab-pill span.small {
        font-size: 0.7rem;
        opacity: 0.8;
      }
      .tab-pill.active {
        background: #f97316;
        border-color: #f97316;
        color: #111827;
      }
      .tab-pill.secondary {
        background: rgba(15, 23, 42, 0.9);
      }
      /* Main card area */
      .content-shell {
        margin-top: 14px;
      }
      .main-card {
        background: #f9fafb;
        border-radius: 20px;
        padding: 18px 14px 18px;
        box-shadow: 0 8px 25px rgba(15, 23, 42, 0.45);
      }
      @media (min-width: 768px) {
        .main-card {
          padding: 22px 24px 24px;
        }
      }
      .section-title {
        font-size: 1rem;
        font-weight: 700;
        color: #111827;
        display: flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 10px;
      }
      .section-title-icon {
        width: 22px;
        height: 22px;
        border-radius: 999px;
        background: #fee2e2;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: #b91c1c;
        font-size: 0.8rem;
      }
      .subtext {
        font-size: 0.8rem;
        color: #6b7280;
      }
      /* Flight card */
      .flight-card {
        border-radius: 18px;
        background: #ecfdf5;
        padding: 14px 16px;
        margin-bottom: 14px;
      }
      .flight-header {
        font-size: 0.85rem;
        color: #047857;
        font-weight: 600;
        margin-bottom: 6px;
      }
      .flight-row {
        display: grid;
        grid-template-columns: 1.3fr auto 1.3fr;
        gap: 6px;
        align-items: center;
        padding: 8px 0;
      }
      .flight-col {
        font-size: 0.9rem;
        color: #111827;
      }
      .flight-airport {
        font-size: 1.4rem;
        font-weight: 800;
        letter-spacing: 0.08em;
      }
      .flight-airport-sub {
        font-size: 0.78rem;
        color: #6b7280;
      }
      .flight-mid {
        text-align: center;
        font-size: 0.8rem;
      }
      .flight-pill {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 4px 10px;
        border-radius: 999px;
        background: #0f766e;
        color: #ecfdf5;
        font-size: 0.78rem;
        font-weight: 600;
      }
      .flight-time {
        font-size: 1.1rem;
        font-weight: 700;
      }
      .flight-date {
        font-size: 0.78rem;
        color: #6b7280;
      }
      .tip-box {
        margin-top: 8px;
        padding: 8px 10px;
        border-radius: 12px;
        background: #fef3c7;
        font-size: 0.8rem;
        color: #92400e;
        display: flex;
        align-items: flex-start;
        gap: 6px;
      }
      .tip-icon {
        font-size: 1rem;
        margin-top: 1px;
      }
      /* Stays */
      .stay-list {
        display: grid;
        gap: 8px;
        margin-top: 4px;
      }
      .stay-item {
        padding: 8px 10px;
        border-radius: 12px;
        background: #eff6ff;
        border: 1px solid #dbeafe;
      }
      .stay-name {
        font-size: 0.9rem;
        font-weight: 600;
        color: #1e3a8a;
      }
      .stay-meta {
        font-size: 0.8rem;
        color: #4b5563;
      }
      /* Day view */
      .day-header-card {
        padding-bottom: 10px;
        border-bottom: 1px dashed #e5e7eb;
        margin-bottom: 12px;
      }
      .day-title-line {
        font-size: 1.02rem;
        font-weight: 700;
        color: #111827;
      }
      .day-sub-line {
        font-size: 0.82rem;
        color: #6b7280;
        margin-top: 2px;
      }
      .day-badges {
        margin-top: 6px;
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }
      .badge {
        padding: 2px 8px;
        border-radius: 999px;
        background: #e5e7eb;
        font-size: 0.75rem;
        color: #4b5563;
      }
      .btn {
        border-radius: 999px;
        border: none;
        padding: 5px 10px;
        font-size: 0.78rem;
        cursor: pointer;
        background: #2563eb;
        color: #f9fafb;
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }
      .btn.outline {
        background: #ffffff;
        color: #1f2937;
        border: 1px solid #d1d5db;
      }
      .btn.sm {
        padding: 3px 8px;
        font-size: 0.72rem;
      }
      .btn-danger {
        background: #dc2626;
        color: #fee2e2;
      }
      .segment {
        margin-top: 10px;
        padding-top: 8px;
        border-top: 1px dashed #e5e7eb;
      }
      .segment-title-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
        margin-bottom: 4px;
      }
      .segment-title {
        font-size: 0.92rem;
        font-weight: 600;
        color: #111827;
      }
      .segment-chip {
        font-size: 0.72rem;
        padding: 2px 7px;
        border-radius: 999px;
        background: #e5e7eb;
        color: #4b5563;
      }
      .segment-notes {
        margin: 0;
        padding-left: 18px;
        font-size: 0.8rem;
        color: #4b5563;
      }
      .routes {
        margin-top: 6px;
        display: grid;
        gap: 8px;
      }
      .route-card {
        border-radius: 12px;
        border: 1px solid #e5e7eb;
        background: #f9fafb;
        padding: 8px 9px;
      }
      .route-header {
        font-size: 0.86rem;
        font-weight: 600;
      }
      .route-meta {
        font-size: 0.78rem;
        color: #6b7280;
        margin-top: 2px;
      }
      .route-steps {
        margin: 4px 0 0;
        padding-left: 18px;
        font-size: 0.78rem;
        color: #6b7280;
      }
      /* Budget block */
      .budget-card {
        margin-top: 8px;
        padding: 8px 10px;
        border-radius: 14px;
        background: #fefce8;
        border: 1px solid #fef3c7;
      }
      .budget-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
        font-size: 0.8rem;
        color: #92400e;
      }
      .budget-total {
        font-weight: 700;
        font-size: 0.9rem;
      }
      .budget-inputs {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 6px;
      }
      .budget-inputs input {
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid #e5e7eb;
        font-size: 0.78rem;
      }
      .budget-list {
        margin-top: 6px;
        max-height: 130px;
        overflow-y: auto;
      }
      .budget-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 6px;
        padding: 3px 0;
        border-bottom: 1px dashed #fde68a;
        font-size: 0.78rem;
        color: #78350f;
      }
      .budget-row:last-child {
        border-bottom: none;
      }
      /* Phrasebook & emergency */
      .phrase-grid {
        display: grid;
        gap: 8px;
      }
      .phrase-item {
        padding: 8px 10px;
        border-radius: 10px;
        background: #eef2ff;
        border: 1px solid #e0e7ff;
        font-size: 0.83rem;
      }
      .phrase-label {
        font-weight: 600;
        color: #1e3a8a;
      }
      .phrase-jp {
        margin-top: 2px;
        color: #4b5563;
      }
      .phrase-note {
        margin-top: 2px;
        font-size: 0.76rem;
        color: #6b7280;
      }
      .emergency-list {
        padding-left: 18px;
        font-size: 0.83rem;
        color: #4b5563;
      }
      .small-muted {
        font-size: 0.78rem;
        color: #6b7280;
      }
      @media (max-width: 640px) {
        .flight-row {
          grid-template-columns: 1fr;
          text-align: left;
        }
        .flight-mid {
          text-align: left;
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="page">
        <div class="app" v-if="loading">
          <div class="hero-card">
            <div class="hero-title">2026 æ±äº¬å®¶åº­æ—…è¡Œ</div>
            <p style="color:#fee2e2;margin-top:6px;">è¼‰å…¥è¡Œç¨‹è¨­å®šä¸­...</p>
          </div>
        </div>

        <div class="app" v-else>
          <!-- Hero header -->
          <header class="hero-card">
            <div class="hero-title">{{ config.tripMeta.title }}</div>
            <div class="hero-subtitle">{{ config.tripMeta.subtitle }}</div>
            <div class="hero-date">
              <div class="hero-date-icon">ğŸ“…</div>
              <div>
                {{ config.tripMeta.startDate }} -
                {{ config.tripMeta.endDate }}
              </div>
            </div>
          </header>

          <!-- Top tabs -->
          <nav class="tabs-strip">
            <button
              class="tab-pill"
              :class="{ active: activeKind === 'overview' }"
              @click="activeKind = 'overview'"
            >
              ç¸½è¦½
            </button>

            <button
              v-for="day in config.days"
              :key="day.date"
              class="tab-pill"
              :class="{
                active: activeKind === 'day' && activeDayDate === day.date
              }"
              @click="selectDay(day.date)"
            >
              <span>{{ shortDate(day.date) }}</span>
              <span class="small">{{ day.label }}</span>
            </button>

            <button
              class="tab-pill secondary"
              :class="{ active: activeKind === 'phrase' }"
              @click="activeKind = 'phrase'"
            >
              æ—¥èª
            </button>

            <button
              class="tab-pill secondary"
              :class="{ active: activeKind === 'emergency' }"
              @click="activeKind = 'emergency'"
            >
              ç·Šæ€¥
            </button>

            <button
              class="tab-pill secondary"
              :class="{ active: activeKind === 'budget' }"
              @click="activeKind = 'budget'"
            >
              è¨˜å¸³
            </button>
          </nav>

          <!-- Main content -->
          <div class="content-shell">
            <div class="main-card" v-if="activeKind === 'overview'">
              <section>
                <div class="section-title">
                  <span class="section-title-icon">âœˆï¸</span>
                  èˆªç­è³‡è¨Š
                </div>
                <div class="subtext">
                  å»ç¨‹ {{ outbound.flightNo }} / å›ç¨‹ {{ inbound.flightNo }}
                </div>

                <!-- Outbound -->
                <div class="flight-card" v-if="outbound">
                  <div class="flight-header">å»ç¨‹èˆªç­</div>
                  <div class="flight-row">
                    <div class="flight-col">
                      <div class="flight-airport">
                        {{ outbound.from.code }}
                      </div>
                      <div class="flight-airport-sub">
                        {{ outbound.from.airport }}<br />
                        Terminal {{ outbound.from.terminal || "-" }}
                      </div>
                    </div>
                    <div class="flight-mid">
                      <div class="flight-pill">{{ outbound.flightNo }}</div>
                      <div
                        style="font-size:0.8rem;color:#6b7280;margin-top:3px;"
                      >
                        âœˆï¸ ç›´é£›
                      </div>
                    </div>
                    <div class="flight-col" style="text-align:right;">
                      <div class="flight-airport">
                        {{ outbound.to.code }}
                      </div>
                      <div class="flight-airport-sub">
                        {{ outbound.to.airport }}<br />
                        Terminal {{ outbound.to.terminal || "-" }}
                      </div>
                    </div>
                  </div>
                  <div
                    style="display:flex;justify-content:space-between;font-size:0.8rem;color:#4b5563;margin-top:4px;"
                  >
                    <div>
                      å‡ºç™¼ï¼š
                      <span class="flight-time">{{
                        timeOnly(outbound.departure)
                      }}</span>
                      <span class="flight-date">
                        {{ dateOnly(outbound.departure) }}
                      </span>
                    </div>
                    <div style="text-align:right;">
                      æŠµé”ï¼š
                      <span class="flight-time">{{
                        timeOnly(outbound.arrival)
                      }}</span>
                      <span class="flight-date">
                        {{ dateOnly(outbound.arrival) }}
                      </span>
                    </div>
                  </div>
                </div>

                <!-- Inbound -->
                <div class="flight-card" v-if="inbound">
                  <div class="flight-header">å›ç¨‹èˆªç­</div>
                  <div class="flight-row">
                    <div class="flight-col">
                      <div class="flight-airport">
                        {{ inbound.from.code }}
                      </div>
                      <div class="flight-airport-sub">
                        {{ inbound.from.airport }}<br />
                        Terminal {{ inbound.from.terminal || "-" }}
                      </div>
                    </div>
                    <div class="flight-mid">
                      <div class="flight-pill">{{ inbound.flightNo }}</div>
                      <div
                        style="font-size:0.8rem;color:#6b7280;margin-top:3px;"
                      >
                        âœˆï¸ ç›´é£›
                      </div>
                    </div>
                    <div class="flight-col" style="text-align:right;">
                      <div class="flight-airport">
                        {{ inbound.to.code }}
                      </div>
                      <div class="flight-airport-sub">
                        {{ inbound.to.airport }}<br />
                        Terminal {{ inbound.to.terminal || "-" }}
                      </div>
                    </div>
                  </div>
                  <div
                    style="display:flex;justify-content:space-between;font-size:0.8rem;color:#4b5563;margin-top:4px;"
                  >
                    <div>
                      å‡ºç™¼ï¼š
                      <span class="flight-time">{{
                        timeOnly(inbound.departure)
                      }}</span>
                      <span class="flight-date">
                        {{ dateOnly(inbound.departure) }}
                      </span>
                    </div>
                    <div style="text-align:right;">
                      æŠµé”ï¼š
                      <span class="flight-time">{{
                        timeOnly(inbound.arrival)
                      }}</span>
                      <span class="flight-date">
                        {{ dateOnly(inbound.arrival) }}
                      </span>
                    </div>
                  </div>
                </div>

                <div class="tip-box">
                  <div class="tip-icon">âš ï¸</div>
                  <div>
                    å»ºè­°å‡ºç™¼å‰è‡³å°‘ <strong>2.5 å°æ™‚</strong> æŠµé”æ©Ÿå ´è¾¦ç†å ±åˆ°èˆ‡æ‰˜é‹ã€‚
                  </div>
                </div>
              </section>

              <section style="margin-top:16px;">
                <div class="section-title">
                  <span class="section-title-icon">ğŸ¨</span>
                  ä½å®¿åˆ†æ®µ
                </div>
                <div class="stay-list">
                  <div
                    class="stay-item"
                    v-for="s in config.stays"
                    :key="s.id"
                  >
                    <div class="stay-name">{{ s.name }}</div>
                    <div class="stay-meta">
                      {{ s.city }} Â· {{ s.area }}<br />
                      {{ s.checkIn }} â†’ {{ s.checkOut }}
                    </div>
                    <div
                      class="stay-meta"
                      v-if="s.notes"
                      style="margin-top:2px;"
                    >
                      {{ s.notes }}
                    </div>
                  </div>
                </div>
              </section>
            </div>

            <!-- Day view -->
            <div class="main-card" v-else-if="activeKind === 'day'">
              <div v-if="currentDay">
                <div class="day-header-card">
                  <div class="day-title-line">
                    {{ currentDay.label }} Â· {{ currentDay.date }}
                  </div>
                  <div class="day-sub-line">
                    {{ currentDay.title }}
                  </div>
                  <div class="day-badges">
                    <span class="badge" v-if="currentDay.stayId">
                      ä½å®¿ï¼š{{ stayName(currentDay.stayId) || currentDay.stayId }}
                    </span>
                    <span class="badge">
                      ä»Šæ—¥æ”¯å‡ºï¼š{{ dayTotal(currentDay.date) }}
                      {{ config.budget.currency }}
                    </span>
                    <button
                      class="btn sm outline"
                      @click="toggleDayCollapse(currentDay.date)"
                    >
                      {{ isDayCollapsed(currentDay.date) ? "å±•é–‹è¡Œç¨‹" : "æ”¶åˆè¡Œç¨‹" }}
                    </button>
                  </div>

                  <!-- å°å‹è¨˜å¸³å€å¡Š -->
                  <div class="budget-card">
                    <div class="budget-header">
                      <div>
                        ä»Šæ—¥è¨˜å¸³ Â·
                        <span class="budget-total">
                          {{ dayTotal(currentDay.date) }}
                          {{ config.budget.currency }}
                        </span>
                      </div>
                      <button
                        class="btn sm outline"
                        @click="clearBudgetForDay(currentDay.date)"
                      >
                        æ¸…é™¤æ­¤æ—¥
                      </button>
                    </div>
                    <div class="budget-inputs">
                      <input
                        type="number"
                        min="0"
                        step="1"
                        v-model="budgetForm.amount"
                        placeholder="é‡‘é¡"
                      />
                      <input
                        type="text"
                        v-model="budgetForm.note"
                        placeholder="èªªæ˜"
                      />
                      <button class="btn sm" @click="addBudgetEntryFor(currentDay.date)">
                        â• è¨˜ä¸€ç­†
                      </button>
                    </div>
                    <div class="budget-list">
                      <div
                        v-for="entry in budgetEntriesFor(currentDay.date)"
                        :key="entry.id"
                        class="budget-row"
                      >
                        <div>
                          <div style="font-weight:600;">
                            {{ entry.amount }} {{ config.budget.currency }}
                          </div>
                          <div v-if="entry.note" class="small-muted">
                            {{ entry.note }}
                          </div>
                        </div>
                        <button
                          class="btn sm outline"
                          @click="removeBudgetEntry(currentDay.date, entry.id)"
                        >
                          åˆªé™¤
                        </button>
                      </div>
                      <div
                        v-if="budgetEntriesFor(currentDay.date).length === 0"
                        class="small-muted"
                      >
                        ç›®å‰å°šæœªè¨˜éŒ„æ”¯å‡ºã€‚
                      </div>
                    </div>
                  </div>
                </div>

                <!-- è¡Œç¨‹å…§å®¹ -->
                <div v-if="!isDayCollapsed(currentDay.date)">
                  <div
                    v-for="(seg, idx) in currentDay.segments"
                    :key="idx"
                    class="segment"
                  >
                    <div class="segment-title-row">
                      <div class="segment-title">
                        {{ segmentEmoji(seg.type) }} {{ seg.title }}
                      </div>
                      <div class="segment-chip">
                        {{ seg.timeOfDay || 'flex' }} Â· {{ seg.type }}
                      </div>
                    </div>

                    <div
                      v-if="seg.type === 'transport' && seg.routes && seg.routes.length"
                      class="routes"
                    >
                      <div
                        v-for="route in seg.routes"
                        :key="route.label"
                        class="route-card"
                      >
                        <div class="route-header">{{ route.label }}</div>
                        <div class="route-meta">
                          <span v-if="route.estimatedDurationMinutes">
                            ç´„ {{ route.estimatedDurationMinutes }} åˆ†
                          </span>
                          <span
                            v-if="route.estimatedDistanceKm"
                            style="margin-left:4px;"
                          >
                            Â· ç´„ {{ route.estimatedDistanceKm }} km
                          </span>
                        </div>
                        <ul
                          v-if="route.via && route.via.length"
                          class="route-steps"
                        >
                          <li v-for="s in route.via" :key="s">{{ s }}</li>
                        </ul>
                        <button
                          v-if="route.gmapsUrl"
                          class="btn sm"
                          @click="openMaps(route.gmapsUrl)"
                        >
                          åœ¨ Google Maps é–‹å•Ÿ
                        </button>
                      </div>
                    </div>

                    <ul
                      v-if="seg.notes && seg.notes.length"
                      class="segment-notes"
                    >
                      <li v-for="n in seg.notes" :key="n">{{ n }}</li>
                    </ul>
                  </div>
                </div>
                <div
                  v-else
                  class="small-muted"
                  style="margin-top:10px;font-style:italic;"
                >
                  ä»Šæ—¥è¡Œç¨‹å·²æ”¶åˆï¼Œé»ã€Œå±•é–‹è¡Œç¨‹ã€å¯å†æ¬¡é¡¯ç¤ºæ‰€æœ‰ç´°ç¯€ã€‚
                </div>
              </div>
            </div>

            <!-- Phrasebook -->
            <div class="main-card" v-else-if="activeKind === 'phrase'">
              <section>
                <div class="section-title">
                  <span class="section-title-icon">ğŸ—£ï¸</span>
                  æ‰‹æŒ‡æ—¥æ–‡
                </div>
                <p class="small-muted" style="margin-bottom:8px;">
                  åœ¨æ—¥æœ¬åªè¦æŠŠæ‰‹æ©Ÿéçµ¦å°æ–¹ã€æŒ‡è‘—é€™äº›å¥å­å°±èƒ½æºé€šã€‚
                </p>
                <div class="phrase-grid">
                  <div
                    class="phrase-item"
                    v-for="p in config.phrasebook"
                    :key="p.id"
                  >
                    <div class="phrase-label">{{ p.label }}</div>
                    <div class="phrase-jp">{{ p.jp }}</div>
                    <div v-if="p.note" class="phrase-note">{{ p.note }}</div>
                  </div>
                </div>
              </section>
            </div>

            <!-- Emergency -->
            <div class="main-card" v-else-if="activeKind === 'emergency'">
              <section>
                <div class="section-title">
                  <span class="section-title-icon">ğŸš¨</span>
                  ç·Šæ€¥ & ç”Ÿç—…
                </div>
                <ul class="emergency-list">
                  <li>æ—¥æœ¬ç·Šæ€¥é›»è©±ï¼šè­¦å¯Ÿ 110ï¼Œæ¶ˆé˜²/æ•‘è­·è»Š 119ã€‚</li>
                  <li>çœ‹ç—…æ™‚å¯ä»¥èªªï¼šã€Œå­ã©ã‚‚ãŒç†±ãŒã‚ã‚Šã¾ã™ã€‚ã€ï¼ˆå°å­©ç™¼ç‡’äº†ï¼‰ã€‚</li>
                  <li>å¯åœ¨è—¥å±€å°‹æ‰¾ã€Œå°å…ç”¨ è§£ç†±é®ç—›è–¬ã€æˆ–é€€ç†±è²¼ã€‚</li>
                  <li>è¨˜å¾—æ”œå¸¶è­·ç…§èˆ‡ä¿éšªæ–‡ä»¶ï¼Œæ–¹ä¾¿é†«é™¢ç™»è¨˜ã€‚</li>
                </ul>
                <p class="small-muted" style="margin-top:8px;">
                  ï¼ˆä½ å¯ä»¥ä¾å¯¦éš›è¡Œç¨‹ï¼ŒæŠŠå¸¸ç”¨é†«é™¢ã€è—¥å±€çš„ Google Maps é€£çµè£œåˆ°
                  trip-config.json æˆ–ç›´æ¥å¯«åœ¨é€™è£¡ï¼‰
                </p>
              </section>
            </div>

            <!-- å…¨åŸŸè¨˜å¸³é  -->
            <div class="main-card" v-else-if="activeKind === 'budget'">
              <section>
                <div class="section-title">
                  <span class="section-title-icon">ğŸ’°</span>
                  æ—…éŠè¨˜å¸³ç¸½è¦½
                </div>
                <p class="small-muted">
                  å¹£åˆ¥ï¼š{{ config.budget.currency }} Â·
                  æ‰€æœ‰è³‡æ–™ä¿å­˜åœ¨é€™å°è£ç½®çš„ localStorageï¼ˆä¸æœƒä¸Šå‚³ï¼‰ã€‚
                </p>

                <div style="margin-top:10px;">
                  <div
                    v-for="d in config.budget.days"
                    :key="d.date"
                    style="margin-bottom:10px;padding-bottom:8px;border-bottom:1px dashed #e5e7eb;"
                  >
                    <div
                      style="display:flex;justify-content:space-between;align-items:center;gap:8px;"
                    >
                      <div>
                        <strong>{{ d.label }}</strong>
                        <span class="small-muted">ï¼ˆ{{ d.date }}ï¼‰</span>
                      </div>
                      <div class="budget-total">
                        {{ dayTotal(d.date) }} {{ config.budget.currency }}
                      </div>
                    </div>
                    <div class="small-muted" style="margin-top:2px;">
                      ç´€éŒ„ {{ budgetEntriesFor(d.date).length }} ç­†
                    </div>
                  </div>
                  <div style="margin-top:4px;">
                    <button
                      class="btn btn-danger sm"
                      @click="clearAllBudget"
                    >
                      âš ï¸ æ¸…é™¤æ‰€æœ‰è¨˜å¸³è³‡æ–™
                    </button>
                  </div>
                </div>
              </section>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Vue 3 ESM -->
    <script type="module">
      const BUDGET_KEY = "trip-budget-v1";

      import { createApp, computed } from "https://unpkg.com/vue@3/dist/vue.esm-browser.js";

      createApp({
        data() {
          return {
            config: null,
            loading: true,
            activeKind: "overview",
            activeDayDate: "",
            collapsedDays: {},

            budgetData: {}, // { [date]: [{id, amount, note}] }
            budgetForm: {
              amount: "",
              note: "",
            },
          };
        },
        computed: {
          outbound() {
            return this.config.flights.find((f) => f.direction === "outbound");
          },
          inbound() {
            return this.config.flights.find((f) => f.direction === "inbound");
          },
          currentDay() {
            return this.config.days.find((d) => d.date === this.activeDayDate);
          },
        },
        methods: {
          shortDate(dateStr) {
            // "2026-02-11" -> "2/11"
            const [y, m, d] = dateStr.split("-");
            return Number(m) + "/" + Number(d);
          },
          dateOnly(iso) {
            // ç°¡å–®åˆ‡æ‰ T ä¹‹å¾Œ
            return iso.split("T")[0];
          },
          timeOnly(iso) {
            const t = iso.split("T")[1] || "";
            return t.substring(0, 5);
          },
          stayName(id) {
            const s = this.config.stays.find((x) => x.id === id);
            return s ? s.name : null;
          },
          selectDay(date) {
            this.activeKind = "day";
            this.activeDayDate = date;
          },
          openMaps(url) {
            window.open(url, "_blank");
          },
          segmentEmoji(type) {
            switch (type) {
              case "flight":
                return "âœˆï¸";
              case "transport":
                return "ğŸš†";
              case "meal":
                return "ğŸ½ï¸";
              case "activity":
                return "ğŸ¡";
              case "free":
              default:
                return "âœ¨";
            }
          },
          // --- æ‘ºç–Š ---
          isDayCollapsed(date) {
            return !!this.collapsedDays[date];
          },
          toggleDayCollapse(date) {
            this.collapsedDays[date] = !this.collapsedDays[date];
          },
          // --- è¨˜å¸³ ---
          loadBudget() {
            try {
              const raw = localStorage.getItem(BUDGET_KEY);
              this.budgetData = raw ? JSON.parse(raw) : {};
            } catch {
              this.budgetData = {};
            }
            // ç¢ºä¿æ¯å€‹æ—¥æœŸéƒ½æœ‰é™£åˆ—
            this.config.budget.days.forEach((d) => {
              if (!this.budgetData[d.date]) this.budgetData[d.date] = [];
            });
          },
          saveBudget() {
            try {
              localStorage.setItem(BUDGET_KEY, JSON.stringify(this.budgetData));
            } catch {}
          },
          budgetEntriesFor(date) {
            return this.budgetData[date] || [];
          },
          dayTotal(date) {
            const list = this.budgetEntriesFor(date);
            const sum = list.reduce(
              (acc, e) => acc + Number(e.amount || 0),
              0
            );
            return sum.toFixed(0);
          },
          addBudgetEntryFor(date) {
            const amt = Number(this.budgetForm.amount);
            if (!amt || amt <= 0) {
              alert("è«‹è¼¸å…¥å¤§æ–¼ 0 çš„é‡‘é¡");
              return;
            }
            const entry = {
              id: Date.now() + Math.random(),
              amount: amt,
              note: this.budgetForm.note?.trim() || "",
            };
            if (!this.budgetData[date]) this.budgetData[date] = [];
            this.budgetData[date].push(entry);
            this.saveBudget();
            this.budgetForm.amount = "";
            this.budgetForm.note = "";
          },
          removeBudgetEntry(date, id) {
            if (!this.budgetData[date]) return;
            this.budgetData[date] = this.budgetData[date].filter(
              (e) => e.id !== id
            );
            this.saveBudget();
          },
          clearBudgetForDay(date) {
            if (!confirm(`ç¢ºå®šè¦æ¸…é™¤ ${date} çš„æ‰€æœ‰è¨˜å¸³è³‡æ–™å—ï¼Ÿ`)) return;
            this.budgetData[date] = [];
            this.saveBudget();
          },
          clearAllBudget() {
            if (!confirm("âš ï¸ ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ—¥æœŸçš„è¨˜å¸³è³‡æ–™å—ï¼Ÿ")) return;
            this.budgetData = {};
            this.config.budget.days.forEach((d) => {
              this.budgetData[d.date] = [];
            });
            this.saveBudget();
          },
        },
        async mounted() {
          try {
            const res = await fetch(
              "./trip-config.json?ts=" + Date.now().toString()
            );
            this.config = await res.json();

            // åˆå§‹åŒ– active day
            if (this.config.days.length > 0) {
              this.activeDayDate = this.config.days[0].date;
            }

            // åˆå§‹åŒ–è¨˜å¸³
            this.loadBudget();
          } catch (e) {
            console.error("è¼‰å…¥ trip-config.json å¤±æ•—", e);
            alert("è¼‰å…¥ trip-config.json å¤±æ•—ï¼Œè«‹ç¢ºèªæª”æ¡ˆæœ‰æ”¾åœ¨æ ¹ç›®éŒ„ã€‚");
          } finally {
            this.loading = false;
          }
        },
      }).mount("#app");
    </script>
  </body>
</html>
