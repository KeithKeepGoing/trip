<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2026 æ±äº¬å®¶åº­æ—…è¡Œ ğŸŒ¸</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Zen Maru Gothic', sans-serif;
      background-color: #fdf2f8; /* pink-50 */
    }
    .sakura-bg {
      background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23fbcfe8' fill-opacity='0.4' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3Ccircle cx='13' cy='13' r='3'/%3E%3C/g%3E%3C/svg%3E");
    }
  </style>
</head>
<body class="sakura-bg min-h-screen text-slate-800 pb-12">
  <div id="app" class="max-w-md mx-auto bg-white min-h-screen shadow-xl sm:rounded-xl sm:my-8 sm:min-h-[auto] overflow-hidden">
    
    <!-- Loading State -->
    <div v-if="loading" class="flex flex-col items-center justify-center h-screen space-y-4">
      <div class="animate-spin text-4xl">ğŸŒ¸</div>
      <div class="text-slate-500 font-medium">è¼‰å…¥ç¾å¥½æ—…ç¨‹ä¸­...</div>
    </div>

    <!-- Main Content -->
    <div v-else>
      <!-- Hero Header -->
      <header class="relative bg-gradient-to-br from-pink-400 to-rose-500 text-white p-6 pb-12">
        <div class="absolute top-0 left-0 w-full h-full opacity-10" style="background-image: radial-gradient(circle, #fff 2px, transparent 2.5px); background-size: 20px 20px;"></div>
        <div class="relative z-10">
          <h1 class="text-2xl font-bold tracking-wide mb-1">{{ config.tripMeta.title }}</h1>
          <p class="text-pink-100 text-sm font-medium">{{ config.tripMeta.subtitle }}</p>
          <div class="mt-4 inline-flex items-center bg-white/20 backdrop-blur-sm px-3 py-1.5 rounded-full text-xs font-semibold">
            <span>ğŸ“… {{ config.tripMeta.startDate }}</span>
            <span class="mx-2">â†’</span>
            <span>{{ config.tripMeta.endDate }}</span>
          </div>
        </div>
      </header>

      <!-- Navigation Tabs -->
      <div class="px-4 -mt-6 relative z-20 flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
        <button 
          @click="activeKind = 'overview'"
          :class="['flex-shrink-0 px-4 py-2 rounded-full text-sm font-bold shadow-sm transition-all', activeKind === 'overview' ? 'bg-white text-rose-500 ring-2 ring-rose-100' : 'bg-white/90 text-slate-500 hover:bg-white']"
        >
          ç¸½è¦½
        </button>
        <button 
          v-for="day in config.days" 
          :key="day.date"
          @click="selectDay(day.date)"
          :class="['flex-shrink-0 px-4 py-2 rounded-full text-sm font-bold shadow-sm transition-all flex flex-col items-center leading-none gap-1', activeKind === 'day' && activeDayDate === day.date ? 'bg-white text-rose-500 ring-2 ring-rose-100' : 'bg-white/90 text-slate-500 hover:bg-white']"
        >
          <span>{{ day.label }}</span>
          <span class="text-[10px] opacity-70">{{ shortDate(day.date) }}</span>
        </button>
        <button 
          @click="activeKind = 'phrase'"
          :class="['flex-shrink-0 px-4 py-2 rounded-full text-sm font-bold shadow-sm transition-all', activeKind === 'phrase' ? 'bg-white text-rose-500 ring-2 ring-rose-100' : 'bg-white/90 text-slate-500 hover:bg-white']"
        >
          æ—¥èª
        </button>
        <button 
          @click="activeKind = 'budget'"
          :class="['flex-shrink-0 px-4 py-2 rounded-full text-sm font-bold shadow-sm transition-all', activeKind === 'budget' ? 'bg-white text-rose-500 ring-2 ring-rose-100' : 'bg-white/90 text-slate-500 hover:bg-white']"
        >
          è¨˜å¸³
        </button>
      </div>

      <!-- Content Area -->
      <main class="p-4 space-y-4">
        
        <!-- Overview Tab -->
        <div v-if="activeKind === 'overview'" class="space-y-4">
          <!-- Flights -->
          <section>
            <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-2 flex items-center gap-2">
              <span class="text-lg">âœˆï¸</span> èˆªç­è³‡è¨Š
            </h3>
            <div class="space-y-3">
              <div v-for="f in config.flights" :key="f.id" class="bg-slate-50 rounded-2xl p-4 border border-slate-100">
                <div class="flex justify-between items-center mb-3">
                  <span class="text-xs font-bold text-rose-500 bg-rose-50 px-2 py-1 rounded">{{ f.direction === 'outbound' ? 'å»ç¨‹' : 'å›ç¨‹' }}</span>
                  <span class="text-xs font-bold text-slate-500">{{ f.airline }} Â· {{ f.flightNo }}</span>
                </div>
                <div class="flex justify-between items-center">
                  <div class="text-center">
                    <div class="text-2xl font-black text-slate-800">{{ f.from.code }}</div>
                    <div class="text-xs text-slate-500">{{ timeOnly(f.departure) }}</div>
                  </div>
                  <div class="flex-1 px-4 flex flex-col items-center">
                    <div class="text-[10px] text-slate-400">ç›´é£›</div>
                    <div class="w-full h-px bg-slate-300 relative top-1"></div>
                    <div class="text-lg relative -top-2">âœˆï¸</div>
                  </div>
                  <div class="text-center">
                    <div class="text-2xl font-black text-slate-800">{{ f.to.code }}</div>
                    <div class="text-xs text-slate-500">{{ timeOnly(f.arrival) }}</div>
                  </div>
                </div>
                <div class="mt-3 pt-3 border-t border-slate-200 flex justify-between text-xs text-slate-500">
                  <span>{{ dateOnly(f.departure) }}</span>
                  <span>{{ f.from.terminal }} èˆªå»ˆ â†’ {{ f.to.terminal }} èˆªå»ˆ</span>
                </div>
              </div>
            </div>
          </section>

          <!-- Stays -->
          <section>
            <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-2 flex items-center gap-2">
              <span class="text-lg">ğŸ¨</span> ä½å®¿å®‰æ’
            </h3>
            <div class="space-y-3">
              <div v-for="s in config.stays" :key="s.id" class="bg-white rounded-2xl p-4 border border-slate-100 shadow-sm relative overflow-hidden group">
                <div class="absolute left-0 top-0 bottom-0 w-1.5 bg-rose-400 group-hover:bg-rose-500 transition-colors"></div>
                <div class="pl-2">
                  <h4 class="font-bold text-slate-800">{{ s.name }}</h4>
                  <div class="text-xs text-slate-500 mt-1 flex items-center gap-1">
                    <span>ğŸ“ {{ s.area }}</span>
                    <span>Â·</span>
                    <span>{{ shortDate(s.checkIn) }} - {{ shortDate(s.checkOut) }}</span>
                  </div>
                  <div v-if="s.notes" class="text-xs text-slate-600 mt-2 bg-slate-50 p-2 rounded">
                    ğŸ’¡ {{ s.notes }}
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>

        <!-- Day View Tab -->
        <div v-else-if="activeKind === 'day'" class="space-y-4">
          <div v-if="currentDay">
            <!-- Day Header -->
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100 mb-4 text-center">
              <div class="text-xs font-bold text-rose-500 mb-1">{{ currentDay.date }} Â· {{ currentDay.label }}</div>
              <h2 class="text-xl font-black text-slate-800 mb-2">{{ currentDay.title }}</h2>
              <div class="flex flex-wrap justify-center gap-2 mt-3">
                <span v-if="currentDay.stayId" class="text-[10px] bg-indigo-50 text-indigo-600 px-2 py-1 rounded-full font-bold">
                  ğŸ  {{ stayName(currentDay.stayId) }}
                </span>
                <span class="text-[10px] bg-emerald-50 text-emerald-600 px-2 py-1 rounded-full font-bold">
                  ğŸ’° {{ dayTotal(currentDay.date) }} {{ config.budget.currency }}
                </span>
              </div>
              
              <!-- Quick Budget -->
              <div class="mt-4 pt-4 border-t border-slate-100">
                 <button @click="showBudget = !showBudget" class="text-xs font-bold text-slate-400 hover:text-rose-500 flex items-center justify-center w-full gap-1">
                    {{ showBudget ? 'æ”¶èµ·è¨˜å¸³' : 'âœï¸ å¿«é€Ÿè¨˜å¸³' }}
                 </button>
                 <div v-if="showBudget" class="mt-3 bg-slate-50 p-3 rounded-xl animate-fade-in">
                    <div class="flex gap-2 mb-2">
                       <input v-model="budgetForm.amount" type="number" placeholder="$" class="w-20 px-3 py-2 rounded-lg border border-slate-200 text-sm focus:outline-none focus:ring-2 focus:ring-rose-400">
                       <input v-model="budgetForm.note" type="text" placeholder="é …ç›®" class="flex-1 px-3 py-2 rounded-lg border border-slate-200 text-sm focus:outline-none focus:ring-2 focus:ring-rose-400">
                       <button @click="addBudgetEntryFor(currentDay.date)" class="bg-rose-500 text-white px-3 py-2 rounded-lg font-bold text-sm hover:bg-rose-600">+</button>
                    </div>
                    <div class="space-y-1">
                       <div v-for="entry in budgetEntriesFor(currentDay.date)" :key="entry.id" class="flex justify-between items-center text-xs p-1 px-2 hover:bg-white rounded">
                          <span class="text-slate-600">{{ entry.note || 'æ”¯å‡º' }}</span>
                          <div class="flex items-center gap-2">
                             <span class="font-bold">{{ entry.amount }}</span>
                             <button @click="removeBudgetEntry(currentDay.date, entry.id)" class="text-slate-300 hover:text-red-500">Ã—</button>
                          </div>
                       </div>
                    </div>
                 </div>
              </div>
            </div>

            <!-- Timeline Blocks -->
            <div class="relative pl-4 space-y-6 before:content-[''] before:absolute before:left-[23px] before:top-4 before:bottom-0 before:w-0.5 before:bg-slate-200">
              
              <div v-for="(block, idx) in currentDay.blocks" :key="idx" class="relative pl-8 group">
                <!-- Timeline Dot -->
                <div class="absolute left-0 top-1 w-12 flex justify-center z-10">
                   <div class="w-8 h-8 rounded-full bg-white border-4 border-slate-100 flex items-center justify-center text-sm shadow-sm group-hover:border-rose-100 transition-colors">
                      {{ getBlockIcon(block.type) }}
                   </div>
                </div>

                <!-- Card Content -->
                <div class="bg-white rounded-xl p-4 shadow-sm border border-slate-100 hover:shadow-md transition-shadow">
                   <div class="flex justify-between items-start mb-2">
                      <h3 class="font-bold text-slate-800">{{ block.title }}</h3>
                      <span v-if="block.timeOfDay" class="text-[10px] font-bold bg-slate-100 text-slate-500 px-2 py-0.5 rounded-full">{{ block.timeOfDay }}</span>
                   </div>

                   <!-- Type: Transport -->
                   <div v-if="block.type === 'transport'" class="space-y-3">
                      <div class="text-sm text-slate-600 flex items-center gap-2">
                         <span>{{ block.from }}</span>
                         <span class="text-slate-300">âœ</span>
                         <span>{{ block.to }}</span>
                      </div>
                      <div v-for="route in block.routes" class="bg-slate-50 rounded-lg p-3 text-sm">
                         <div class="font-bold text-slate-700 mb-1">{{ route.label }}</div>
                         <div class="text-xs text-slate-500 mb-2">
                            â± {{ route.estimatedDurationMinutes }}åˆ† Â· ğŸ’° {{ route.estimatedCost }}
                         </div>
                         <ol class="list-decimal list-inside text-xs text-slate-600 space-y-1 mb-2 pl-1">
                            <li v-for="step in route.via">{{ step }}</li>
                         </ol>
                         <button v-if="route.gmapsUrl" @click="openMaps(route.gmapsUrl)" class="text-[10px] bg-white border border-slate-200 px-2 py-1 rounded text-slate-500 font-bold hover:bg-blue-50 hover:text-blue-600 flex items-center gap-1 w-fit">
                            ğŸ—º Google Maps
                         </button>
                      </div>
                   </div>

                   <!-- Type: List (Packing/Todo) -->
                   <ul v-else-if="block.items" class="space-y-1">
                      <li v-for="item in block.items" class="text-sm text-slate-600 flex items-start gap-2">
                         <span class="text-rose-400 mt-1">â€¢</span>
                         <span class="flex-1">{{ item }}</span>
                      </li>
                   </ul>

                   <!-- Type: Note -->
                   <div v-else-if="block.lines" class="bg-yellow-50 rounded-lg p-3 text-sm text-yellow-800 space-y-1">
                      <p v-for="line in block.lines">{{ line }}</p>
                   </div>
                   
                   <!-- Type: Meal Options -->
                   <div v-else-if="block.options" class="grid gap-2">
                      <div v-for="opt in block.options" class="bg-orange-50 rounded-lg p-3">
                         <div class="font-bold text-orange-900 text-sm mb-1">{{ opt.label }}</div>
                         <div class="text-xs text-orange-700/80 space-y-1">
                            <div v-if="opt.pros">ğŸ‘ {{ opt.pros.join('ã€') }}</div>
                            <div v-if="opt.cons">âš ï¸ {{ opt.cons.join('ã€') }}</div>
                         </div>
                      </div>
                   </div>

                </div>
              </div>
            </div>
            
            <div class="h-8"></div> <!-- spacer -->
          </div>
        </div>

        <!-- Phrasebook Tab -->
        <div v-else-if="activeKind === 'phrase'" class="grid grid-cols-1 gap-3">
          <div v-for="p in config.phrasebook" class="bg-white rounded-xl p-4 shadow-sm border border-slate-100 flex flex-col gap-1 active:scale-[0.98] transition-transform cursor-pointer" @click="speak(p.jp)">
             <div class="font-bold text-rose-500">{{ p.label }}</div>
             <div class="text-lg font-medium text-slate-800">{{ p.jp }}</div>
             <div class="text-xs text-slate-400 flex justify-between items-center mt-1">
                <span>{{ p.note }}</span>
                <span class="text-[10px] bg-slate-100 px-2 py-0.5 rounded">é»æ“Šç™¼éŸ³ ğŸ”Š</span>
             </div>
          </div>
        </div>
        
        <!-- Budget Tab -->
        <div v-else-if="activeKind === 'budget'" class="space-y-4">
           <div class="bg-white rounded-xl p-5 shadow-sm border border-slate-100 text-center">
              <div class="text-sm text-slate-400 mb-1">ç¸½æ”¯å‡º</div>
              <div class="text-3xl font-black text-slate-800">{{ totalBudget() }} <span class="text-sm font-medium text-slate-400">{{ config.budget.currency }}</span></div>
              <p class="text-[10px] text-slate-400 mt-2">è³‡æ–™ä¿å­˜åœ¨æœ¬æ©Ÿ LocalStorageï¼Œä¸å¤–æµã€‚</p>
           </div>
           
           <div class="space-y-2">
              <div v-for="d in config.days" class="bg-white rounded-xl px-4 py-3 border border-slate-100 flex justify-between items-center">
                 <div>
                    <div class="font-bold text-slate-700">{{ d.label }}</div>
                    <div class="text-xs text-slate-400">{{ shortDate(d.date) }}</div>
                 </div>
                 <div class="font-bold text-rose-500">
                    {{ dayTotal(d.date) }}
                 </div>
              </div>
           </div>
           
           <button @click="clearAllBudget" class="w-full py-3 text-xs font-bold text-red-400 hover:text-red-600">æ¸…é™¤æ‰€æœ‰è¨˜éŒ„</button>
        </div>

      </main>
    </div>
  </div>

  <script>
    const { createApp, ref, computed, onMounted } = Vue;
    const BUDGET_KEY = "trip-budget-v1";

    createApp({
      setup() {
        const config = ref(null);
        const loading = ref(true);
        const activeKind = ref('overview');
        const activeDayDate = ref('');
        const budgetData = ref({});
        const budgetForm = ref({ amount: '', note: '' });
        const showBudget = ref(false);

        // Helper: Icons
        const getBlockIcon = (type) => {
          const map = {
            'transport': 'ğŸš†',
            'packingToday': 'ğŸ’',
            'todo': 'âœ…',
            'mealOptions': 'ğŸ½ï¸',
            'note': 'ğŸ“'
          };
          return map[type] || 'ğŸ“';
        };

        // Computed
        const outbound = computed(() => config.value?.flights.find(f => f.direction === 'outbound'));
        const inbound = computed(() => config.value?.flights.find(f => f.direction === 'inbound'));
        const currentDay = computed(() => config.value?.days.find(d => d.date === activeDayDate.value));

        // Formatters
        const shortDate = (s) => s ? s.split('-').slice(1).join('/') : '';
        const dateOnly = (s) => s ? s.split('T')[0] : '';
        const timeOnly = (s) => s ? s.split('T')[1]?.substring(0,5) : '';
        const stayName = (id) => config.value?.stays.find(s => s.id === id)?.name;

        // Actions
        const selectDay = (date) => {
          activeKind.value = 'day';
          activeDayDate.value = date;
          showBudget.value = false;
        };
        const openMaps = (url) => window.open(url, '_blank');
        const speak = (text) => {
           const u = new SpeechSynthesisUtterance(text);
           u.lang = 'ja-JP';
           window.speechSynthesis.speak(u);
        };

        // Budget Logic
        const loadBudget = () => {
           const raw = localStorage.getItem(BUDGET_KEY);
           if(raw) budgetData.value = JSON.parse(raw);
        };
        const saveBudget = () => localStorage.setItem(BUDGET_KEY, JSON.stringify(budgetData.value));
        const budgetEntriesFor = (date) => budgetData.value[date] || [];
        const dayTotal = (date) => (budgetData.value[date] || []).reduce((a,b) => a + Number(b.amount), 0);
        const totalBudget = () => Object.values(budgetData.value).flat().reduce((a,b) => a + Number(b.amount), 0);
        
        const addBudgetEntryFor = (date) => {
           if(!budgetForm.value.amount) return;
           if(!budgetData.value[date]) budgetData.value[date] = [];
           budgetData.value[date].push({
              id: Date.now(),
              amount: budgetForm.value.amount,
              note: budgetForm.value.note
           });
           budgetForm.value = { amount: '', note: '' };
           saveBudget();
        };
        const removeBudgetEntry = (date, id) => {
           budgetData.value[date] = budgetData.value[date].filter(e => e.id !== id);
           saveBudget();
        };
        const clearAllBudget = () => {
           if(confirm('ç¢ºå®šæ¸…é™¤ï¼Ÿ')) {
              budgetData.value = {};
              saveBudget();
           }
        }

        // Init
        onMounted(async () => {
          try {
            const res = await fetch('./trip-config.json?t=' + Date.now());
            config.value = await res.json();
            if(config.value.days.length) activeDayDate.value = config.value.days[0].date;
            loadBudget();
          } catch(e) {
             console.error(e);
          } finally {
             loading.value = false;
          }
        });

        return {
          config, loading, activeKind, activeDayDate, currentDay,
          outbound, inbound, budgetForm, showBudget,
          shortDate, dateOnly, timeOnly, stayName, getBlockIcon,
          selectDay, openMaps, speak,
          budgetEntriesFor, dayTotal, totalBudget, addBudgetEntryFor, removeBudgetEntry, clearAllBudget
        };
      }
    }).mount('#app');
  </script>
</body>
</html>
